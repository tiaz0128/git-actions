name: Run pytest

on:
  pull_request:
    branches:
      - solution
      - '**/0[0-9]'
      - '**/[1-9][0-9]'
      - '**/[1-9][0-9][0-9]'
    types:
      - opened
      - synchronize
jobs:

  extract-num:
    runs-on: ubuntu-latest

    outputs:
      solution: ${{ steps.extract.outputs.solution }}

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Print Context
      run: | 
        echo ${{ github.ref }}
        echo ${{ github.ref_name }}
        echo ${{ github.head_ref }}
        echo ${{ github.action_status }}
        echo ${{ github.event_name }}
        echo ${{ github.event_path }}
    - name: Read solution number from Branch
      id: extract
      run: |
        echo "solution=$(python ./script/get_number.py ${{ github.head_ref }})" >> $GITHUB_OUTPUT
    - name: Print solution number
      run: echo ${{ steps.extract.outputs.solution }}
  
  get-info:
    runs-on: ubuntu-latest
    needs: extract-num

    outputs:
      info: ${{ steps.extract-json.outputs.info }}
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Print extract solution number
        run: echo ${{needs.extract-num.outputs.solution }}
      - name: Read solution-info from JSON
        id: extract-json
        run: |
          echo "info=$(python ./script/read_json.py ${{ needs.extract-num.outputs.solution }})" >> $GITHUB_OUTPUT
      - name: Print solution info
        run: echo ${{ steps.extract-json.outputs.info }}
        
  # hello-comment:
  #   runs-on: ubuntu-latest
  #   needs: [extract-num, get-info]

  #   outputs:
  #     info: ${{ steps.extract-json.outputs.info }}

  #   steps:
  #     - name: Checkout repository
  #       uses: actions/checkout@v4
      
  #     - name: print solution number
  #       run: echo ${{ needs.extract-num.outputs.solution }}


  
  #     - name: Auto Comment on Pull Request
  #       if: github.event_name == 'pull_request' && github.event.action == 'opened'
  #       uses: wow-actions/auto-comment@v1
  #       with:
  #         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  #         pullRequestOpened: |
  #           ğŸ‘‹ @{{ author }} ë‹˜ ì•ˆë…•í•˜ì„¸ìš”!
  #           ë¬¸ì œ ${{ needs.extract-num.outputs.solution }} ë¥¼ í’€ê³  ìˆìœ¼ì‹œë„¤ìš”!
  #           í•´ë‹¹ ë¬¸ì œëŠ” ì±…ì˜ ì•„ë˜ì˜ í˜ì´ì§€ì™€ í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ ë§í¬ë¥¼ ì•Œë ¤ë“œë¦´ê»˜ìš”!

  #           ì°¸ì¡° : ${{ steps.extract-json.outputs.info }}
            
  #           1. í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•œ ê²½ìš° ë‹¤ì‹œ í•œë²ˆ ë¬¸ì œë¥¼ í’€ì–´ì„œ `push` í•´ë³´ì„¸ìš”!
  #           2. ë¡œì»¬ì—ì„œ ë””ë²„ê¹…ë„ í•´ë³´ê³  ìŠ¤ìŠ¤ë¡œ ì½”ë©˜íŠ¸ë¥¼ ë‹¬ë©´ì„œ ê³µë¶€í•´ë³´ì„¸ìš”! 
  #           3. ë‹¤ì‹œ í•œë²ˆ ë¬¸ì œë¥¼ í’€ì–´ì„œ `push` í•´ë³´ì„¸ìš”!

  # test:
  #   runs-on: ubuntu-latest
  #   needs: extract-num

  #   strategy:
  #     matrix:
  #       python-version:
  #         - '3.8'

  #   steps:
  #   - name: Checkout repository
  #     uses: actions/checkout@v4

  #   - name: Set up Python
  #     uses: actions/setup-python@v5
  #     with:
  #       python-version: ${{ matrix.python-version }}

  #   - name: Install dependencies
  #     run: |
  #       python -m pip install --upgrade pip
  #       pip install pytest python-dotenv

  #   - name: Run pytest
  #     run: pytest --id=${{ author }} -k 'test_${{ needs.extract-num.outputs.solution }}'

  # review-fail:
  #   runs-on: ubuntu-latest
  #   needs: test
  #   if: failure()
  #   steps:
  #   - name: if fail test 
  #     uses: wow-actions/auto-comment@v1
  #     with:
  #       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  #       pullRequestOpened: |
  #          âŒ @{{author}} ë‹˜. ì•„ì‰½ìŠµë‹ˆë‹¤.
           
  #          í…ŒìŠ¤íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
  #          ë‹¤ì‹œ í•œë²ˆ ë¬¸ì œë¥¼ í’€ê³ , `push` í•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•´ë³´ì„¸ìš”!

  #       pullRequestSynchronize: |
  #          âŒ @{{author}} ë‹˜. ì•„ì‰½ìŠµë‹ˆë‹¤.
           
  #          í…ŒìŠ¤íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
  #          ë‹¤ì‹œ í•œë²ˆ ë¬¸ì œë¥¼ í’€ê³ , `push` í•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•´ë³´ì„¸ìš”!

  # review-pass:
  #   runs-on: ubuntu-latest
  #   needs: [extract-num, test, ]
  #   if: success()
  #   steps:
  #   - name: if pass test
  #     uses: wow-actions/auto-comment@v1
  #     with:
  #       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  #       pullRequestOpened: |
  #           ğŸ‰ @{{ author }} ë‹˜. ì¶•í•˜ í•©ë‹ˆë‹¤! 
            
  #           ë¬¸ì œ `${{ needs.extract-num.outputs.solution }}` í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ì…¨ìŠµë‹ˆë‹¤!
  #           soluton ë¸Œëœì¹˜ì— Merge í•´ì£¼ì„¸ìš”!
    
  #       pullRequestSynchronize: |
  #           ğŸ‰ @{{ author }} ë‹˜. ì¶•í•˜ í•©ë‹ˆë‹¤! 
            
  #           ë¬¸ì œ `${{ needs.extract-num.outputs.solution }}` í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ì…¨ìŠµë‹ˆë‹¤!
  #           soluton ë¸Œëœì¹˜ì— Merge í•´ì£¼ì„¸ìš”!
    